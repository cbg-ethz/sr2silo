{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"sr2silo","text":"<p>Convert BAM nucleotide alignments to cleartext alignments for LAPIS-SILO</p> <p>sr2silo processes short-read nucleotide alignments from <code>.bam</code> files, translates and aligns reads in amino acids, and outputs JSON compatible with LAPIS-SILO v0.8.0+.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>BAM to JSON conversion: Transform CIGAR alignments to cleartext format</li> <li>Amino acid translation: Translate and align reads using Diamond/BlastX</li> <li>Insertion/deletion handling: Gracefully extract and represent indels</li> <li>Multi-organism support: Process COVID-19, RSV-A, and other pathogens</li> <li>Loculus integration: Direct submission to Loculus backend</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Install from Bioconda\nconda install -c bioconda sr2silo\n\n# Process BAM data\nsr2silo process-from-vpipe \\\n    --input-file input.bam \\\n    --sample-id SAMPLE_001 \\\n    --timeline-file timeline.tsv \\\n    --organism covid \\\n    --output-fp output.ndjson.zst\n\n# Submit to Loculus\nsr2silo submit-to-loculus \\\n    --processed-file output.ndjson.zst\n</code></pre>"},{"location":"#inputoutput","title":"Input/Output","text":"<p>Input: BAM/SAM file with CIGAR alignments: <pre><code>294 163 NC_045512.2 79  60  31S220M =   197 400 CTCTTGTAGAT FGGGHHHHLMM ...\n</code></pre></p> <p>Output: Newline-delimited JSON (<code>.ndjson.zst</code>) compatible with LAPIS-SILO v0.8.0+:</p> <pre><code>{\n  \"readId\": \"AV233803:AV044:2411515907:1:10805:5199:3294\",\n  \"sampleId\": \"A1_05_2024_10_08\",\n  \"batchId\": \"20241024_2411515907\",\n  \"samplingDate\": \"2024-10-08\",\n  \"locationName\": \"Lugano (TI)\",\n  \"locationCode\": \"5\",\n  \"sr2siloVersion\": \"1.3.0\",\n  \"main\": {\n    \"sequence\": \"CGGTTTCGTCCGTGTTGCAGCCG...GTGTCAACATCTTAAAGATGGCACTTGTG\",\n    \"insertions\": [\"10:ACTG\", \"456:TACG\"],\n    \"offset\": 4545\n  },\n  \"S\": {\n    \"sequence\": \"MESLVPGFNEKTHVQLSLPVLQVRVRGFGDSVEEVLSEARQHLKDGTCGLVEVEKGV\",\n    \"insertions\": [\"23:A\", \"145:KLM\"],\n    \"offset\": 78\n  },\n  \"ORF1a\": {\n    \"sequence\": \"XXXMESLVPGFNEKTHVQLSLPVLQVRVRGFGDSVEEVLSEARQHLKDGTCGLV\",\n    \"insertions\": [\"2323:TG\", \"2389:CA\"],\n    \"offset\": 678\n  },\n  \"E\": null,\n  \"M\": null,\n  \"N\": null\n}\n</code></pre> <p>See Data Schemas for details on the output format and how to customize it.</p>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Configuration - Environment variables and CLI options</li> <li>Multi-Organism Support - Supported organisms and adding new ones</li> <li>Deployment - Multi-virus cluster deployment</li> <li>Resource Requirements - Memory and storage needs</li> </ul>"},{"location":"#links","title":"Links","text":"<ul> <li>GitHub Repository</li> <li>Bioconda Package</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>We welcome contributions to sr2silo! Whether you're fixing bugs, adding features, improving documentation, or reporting issues, your help is appreciated.</p>"},{"location":"contributing/#ways-to-contribute","title":"Ways to Contribute","text":"<ul> <li>Report bugs: Open an issue describing the problem and how to reproduce it</li> <li>Suggest features: Open an issue to discuss new functionality</li> <li>Submit pull requests: Fix bugs or implement new features</li> <li>Improve documentation: Help make the docs clearer and more complete</li> </ul>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<p>We use Poetry for dependency management and packaging. The project provides multiple environment configurations in the <code>environments/</code> directory.</p>"},{"location":"contributing/#environment-options","title":"Environment Options","text":"<p>Core Environment (basic usage): <pre><code>make setup\n</code></pre></p> <p>Development Environment (recommended for contributors): <pre><code>make setup-dev\n</code></pre></p> <p>Workflow Environment (for Snakemake workflows): <pre><code>make setup-workflow\n</code></pre></p> <p>All Environments: <pre><code>make setup-all\n</code></pre></p>"},{"location":"contributing/#after-setup","title":"After Setup","text":"<pre><code>conda activate sr2silo-dev\npoetry install --with dev\npoetry run pre-commit install\n</code></pre>"},{"location":"contributing/#running-tests","title":"Running Tests","text":"<pre><code>make test\n# or directly:\npytest\n</code></pre>"},{"location":"contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository</li> <li>Clone your fork:    <pre><code>git clone https://github.com/YOUR_USERNAME/sr2silo.git\ncd sr2silo\n</code></pre></li> <li>Set up the development environment (see above)</li> <li>Create a feature branch following our branching strategy</li> <li>Make your changes and run tests</li> <li>Submit a pull request to the <code>dev</code> branch</li> </ol>"},{"location":"contributing/#code-guidelines","title":"Code Guidelines","text":"<ul> <li>Follow existing code style and patterns</li> <li>Add tests for new functionality</li> <li>Update documentation as needed</li> <li>Keep commits focused and write descriptive commit messages</li> </ul>"},{"location":"contributing/#questions","title":"Questions?","text":"<p>Open an issue on GitHub if you have questions about contributing.</p>"},{"location":"api/loculus/","title":"Loculus Integration","text":"<p>Client classes for interacting with Loculus/LAPIS backends.</p>"},{"location":"api/loculus/#loculusclient","title":"LoculusClient","text":""},{"location":"api/loculus/#sr2silo.loculus.LoculusClient","title":"<code>sr2silo.loculus.LoculusClient</code>","text":"<p>Client for interacting with the Loculus API.</p>"},{"location":"api/loculus/#sr2silo.loculus.LoculusClient.__init__","title":"<code>__init__(token_url, backend_url, organism)</code>","text":"<p>Initialize the Loculus client.</p> <p>Parameters:</p> Name Type Description Default <code>token_url</code> <code>str</code> <p>URL for authentication token endpoint (e.g. 'https:///realms//protocol/openid-connect/token') required <code>backend_url</code> <code>str</code> <p>Base URL for backend endpoint</p> required <code>organism</code> <code>str</code> <p>Organism identifier (e.g., 'covid')</p> required"},{"location":"api/loculus/#sr2silo.loculus.LoculusClient.approve_all","title":"<code>approve_all(username)</code>","text":"<p>Approve all processed sequences for the authenticated user.</p> <p>This releases all sequences that have been submitted and processed by the backend, making them publicly available.</p> <p>Parameters:</p> Name Type Description Default <code>username</code> <code>str</code> <p>The username to filter approvals by (only approve      sequences submitted by this user)</p> required <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>Response from the approval API</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If approval fails or authentication token is missing</p>"},{"location":"api/loculus/#sr2silo.loculus.LoculusClient.authenticate","title":"<code>authenticate(username, password)</code>","text":"<p>Fetch an access token from the token endpoint, to use with the Loculus backend. Uses the <code>client_id</code> 'backend-client'.</p>"},{"location":"api/loculus/#sr2silo.loculus.LoculusClient.request_upload","title":"<code>request_upload(group_id, numberFiles)</code>","text":"<p>Request S3 pre-signed URLs to upload files.</p> <p>Parameters:</p> Name Type Description Default <code>group_id</code> <code>int</code> <p>The group ID for the upload request</p> required <code>numberFiles</code> <code>int</code> <p>The number of files to request upload URLs for</p> required <p>Returns:</p> Type Description <code>List[RequestUploadResponse]</code> <p>List of request-upload response objects containing fileId and pre-signed URL</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If the request fails or authentication token is missing</p>"},{"location":"api/loculus/#sr2silo.loculus.LoculusClient.submit","title":"<code>submit(group_id, metadata_file_path, processed_file_path, nucleotide_alignment, submission_id=None, data_use_terms_type='OPEN', resubmit_duplicate=False)</code>","text":"<p>Submit data to the Lapis API using pre-signed upload approach.</p> <p>Parameters:</p> Name Type Description Default <code>group_id</code> <code>int</code> <p>The group ID for the submission</p> required <code>metadata_file_path</code> <code>Path</code> <p>Path to the metadata TSV file</p> required <code>processed_file_path</code> <code>Path</code> <p>Path to the processed data file (e.g., .ndjson.zst)</p> required <code>nucleotide_alignment</code> <code>Path</code> <p>Path to nucleotide alignment file (.bam)</p> required <code>submission_id</code> <code>str | None</code> <p>Unique identifier for this submission            (auto-generated if not provided)</p> <code>None</code> <code>data_use_terms_type</code> <code>str</code> <p>Data use terms type (default: \"OPEN\")</p> <code>'OPEN'</code> <p>Returns:</p> Type Description <code>SubmitResponse</code> <p>Submit response object</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If submission fails or authentication token is missing</p>"},{"location":"api/loculus/#submission","title":"Submission","text":""},{"location":"api/loculus/#sr2silo.loculus.Submission","title":"<code>sr2silo.loculus.Submission</code>","text":"<p>Submission-related utilities. Methods for generating placeholder FASTA files containing \"NNN\" sequences, and S3 links</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.__init__","title":"<code>__init__(fasta, s3_link)</code>","text":"<p>Initialize the Submission object.</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.count_reads","title":"<code>count_reads(silo_input)</code>  <code>staticmethod</code>","text":"<p>Counts the number of reads in a silo input .ndjson.zstd or .ndjson file.</p> <p>Assumption: each line in the file corresponds to one read.</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.create_metadata_file","title":"<code>create_metadata_file(processed_file, count_reads=False)</code>  <code>staticmethod</code>","text":"<p>Create a metadata TSV file with the required submissionId header.</p> <pre><code>The metadata file will be saved in a 'submission' subdirectory of\nits parent directory.\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>processed_file</code> <code>Path</code> <p>Path to the processed file.</p> required <code>count_reads</code> <code>bool</code> <p>Whether to include a countReads column (default: False)</p> <code>False</code> <p>Returns:</p> Type Description <code>tuple[Path, str]</code> <p>Tuple of (Path to the created metadata file, submission ID)</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.generate_placeholder_fasta","title":"<code>generate_placeholder_fasta(submission_ids)</code>  <code>staticmethod</code>","text":"<p>Generates a placeholder FASTA file for each submission ID with \"NNN\" as the sequence.</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.get_submission_ids_from_tsv","title":"<code>get_submission_ids_from_tsv(file_path)</code>  <code>staticmethod</code>","text":"<p>Reads a TSV file and extracts submission IDs by parsing the \"submissionId\" column.</p>"},{"location":"api/loculus/#sr2silo.loculus.Submission.parse_metadata","title":"<code>parse_metadata(silo_input)</code>  <code>staticmethod</code>","text":"<p>Parses the metadata from a silo input .ndjson.zstd or .ndjson returning all metadata fields but readId as a dictionary with keys in snake_case format for internal Python use.</p> <p>The input JSON uses camelCase (matching SILO database schema), but this method returns snake_case keys for Python conventions.</p> Assumptions <ul> <li>the metadata is stored in the root of the object under the keys</li> <li>each read has the same metadata, up to readId</li> </ul>"},{"location":"api/loculus/#lapisclient","title":"LapisClient","text":""},{"location":"api/loculus/#sr2silo.loculus.LapisClient","title":"<code>sr2silo.loculus.LapisClient</code>","text":"<p>Client for interacting with the Lapis API.</p>"},{"location":"api/loculus/#sr2silo.loculus.LapisClient.__init__","title":"<code>__init__(lapisUrl)</code>","text":"<p>Initialize the Lapis client.</p> <p>Parameters:</p> Name Type Description Default <code>lapisUrl</code> <p>Base URL for the Lapis API</p> required"},{"location":"api/loculus/#sr2silo.loculus.LapisClient.referenceGenome","title":"<code>referenceGenome()</code>","text":"<p>Fetch reference genome from the Lapis <code>sample/referenceGenome</code> endpoint.</p> <p>Returns:</p> Type Description <code>dict</code> <p>JSON response as a dictionary.</p> <p>Raises:</p> Type Description <code>Exception</code> <p>If the request fails.</p>"},{"location":"api/loculus/#sr2silo.loculus.LapisClient.referenceGenomeToFasta","title":"<code>referenceGenomeToFasta(reference_json_string, nucleotide_out_fp, amino_acid_out_fp)</code>  <code>staticmethod</code>","text":"<p>Convert a reference JSON from <code>sample/referenceGenome</code> endpoint     to separate nucleotide and amino acid reference FASTA files.</p> <p>Parameters:</p> Name Type Description Default <code>reference_json_string</code> <code>str</code> <p>JSON string containing reference sequences with                     'nucleotideSequences' and 'genes' sections</p> required <code>nucleotide_out_fp</code> <code>Path</code> <p>Path to the output nucleotide FASTA file</p> required <code>amino_acid_out_fp</code> <code>Path</code> <p>Path to the output amino acid FASTA file</p> required <p>Returns:</p> Type Description <code>None</code> <p>None</p>"},{"location":"api/process/","title":"Processing Module","text":"<p>Core functions for BAM processing, translation, and alignment.</p>"},{"location":"api/process/#data-structures","title":"Data Structures","text":""},{"location":"api/process/#alignedread","title":"AlignedRead","text":""},{"location":"api/process/#sr2silo.process.AlignedRead","title":"<code>sr2silo.process.AlignedRead</code>","text":"<p>Class to represent an aligned read.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.__init__","title":"<code>__init__(read_id, unaligned_nucleotide_sequence, aligned_nucleotide_sequence, aligned_nucleotide_sequence_offset, nucleotide_insertions, amino_acid_insertions, aligned_amino_acid_sequences, metadata=None)</code>","text":"<p>Initialize with a AlignedRead object.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.__str__","title":"<code>__str__()</code>","text":"<p>toString method as pretty JSON string.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.get_amino_acid_insertions","title":"<code>get_amino_acid_insertions()</code>","text":"<p>Return the amino acid insertions.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.get_metadata","title":"<code>get_metadata()</code>","text":"<p>Return the metadata.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.set_metadata","title":"<code>set_metadata(metadata)</code>","text":"<p>Set the metadata. Keep as ReadMetadata object to preserve alias information.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.set_nuc_insertion","title":"<code>set_nuc_insertion(nuc_insertion)</code>","text":"<p>Append a nucleotide insertion to the list of nucleotide insertions.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.to_dict","title":"<code>to_dict()</code>","text":"<p>Return a dictionary / json representation of the object.</p> <p>Uses camelCase field names (via Pydantic aliases) for metadata fields to match SILO database schema.</p>"},{"location":"api/process/#sr2silo.process.AlignedRead.to_silo_json","title":"<code>to_silo_json(indent=False)</code>","text":"<p>Validate the aligned read dict using the new SILO schema and return a nicely formatted JSON string conforming to the DB requirements.</p> <p>Parameters:</p> Name Type Description Default <code>indent</code> <code>bool</code> <p>Whether to indent the JSON string, True for pretty print.</p> <code>False</code>"},{"location":"api/process/#gene","title":"Gene","text":""},{"location":"api/process/#sr2silo.process.Gene","title":"<code>sr2silo.process.Gene</code>","text":"<p>Class to represent a gene with a name and a length.</p>"},{"location":"api/process/#sr2silo.process.Gene.__init__","title":"<code>__init__(gene_name, gene_length)</code>","text":"<p>Initialize with a gene name and a gene length.</p>"},{"location":"api/process/#sr2silo.process.Gene.to_dict","title":"<code>to_dict()</code>","text":"<p>Return a dictionary with gene name and gene length.</p>"},{"location":"api/process/#geneset","title":"GeneSet","text":""},{"location":"api/process/#sr2silo.process.GeneSet","title":"<code>sr2silo.process.GeneSet</code>","text":"<p>Class to represent a set of genes for a pathogen</p>"},{"location":"api/process/#sr2silo.process.GeneSet.__init__","title":"<code>__init__(genes)</code>","text":"<p>Initialize with a list of genes.</p>"},{"location":"api/process/#sr2silo.process.GeneSet.get_gene","title":"<code>get_gene(gene_name)</code>","text":"<p>Return a gene by name.</p>"},{"location":"api/process/#sr2silo.process.GeneSet.get_gene_length","title":"<code>get_gene_length(gene_name)</code>","text":"<p>Return the length of a gene.</p>"},{"location":"api/process/#sr2silo.process.GeneSet.get_gene_name_list","title":"<code>get_gene_name_list()</code>","text":"<p>Return a list of genes.</p>"},{"location":"api/process/#sr2silo.process.GeneSet.set_gene_length","title":"<code>set_gene_length(gene_name, gene_length)</code>","text":"<p>Set the length of a gene.</p>"},{"location":"api/process/#sr2silo.process.GeneSet.to_dict","title":"<code>to_dict()</code>","text":"<p>Return a dictionary with gene names as keys and gene length as values.</p>"},{"location":"api/process/#nucinsertion","title":"NucInsertion","text":""},{"location":"api/process/#sr2silo.process.NucInsertion","title":"<code>sr2silo.process.NucInsertion</code>","text":"<p>               Bases: <code>Insertion</code></p> <p>A nuclotide insertion.</p>"},{"location":"api/process/#aainsertion","title":"AAInsertion","text":""},{"location":"api/process/#sr2silo.process.AAInsertion","title":"<code>sr2silo.process.AAInsertion</code>","text":"<p>               Bases: <code>Insertion</code></p> <p>An amino acid insertion.</p>"},{"location":"api/process/#aainsertionset","title":"AAInsertionSet","text":""},{"location":"api/process/#sr2silo.process.AAInsertionSet","title":"<code>sr2silo.process.AAInsertionSet</code>","text":"<p>Class to represent the set of amino acid insertions for a full set of genes.</p>"},{"location":"api/process/#sr2silo.process.AAInsertionSet.__eq__","title":"<code>__eq__(other)</code>","text":"<p>Compare two AAInsertionSet objects by their values.</p> <p>This compares the dictionaries generated by to_dict() method, ensuring a value-based comparison rather than identity-based.</p>"},{"location":"api/process/#sr2silo.process.AAInsertionSet.__init__","title":"<code>__init__(genes)</code>","text":"<p>Initialize with an empty set of insertions for each gene.</p>"},{"location":"api/process/#sr2silo.process.AAInsertionSet.from_dict","title":"<code>from_dict(data)</code>  <code>staticmethod</code>","text":"<p>Create an AAInsertionSet object from a dictionary.</p>"},{"location":"api/process/#sr2silo.process.AAInsertionSet.set_insertions_for_gene","title":"<code>set_insertions_for_gene(gene_name, aa_insertions)</code>","text":"<p>Set the amino acid insertions for a particular gene.</p>"},{"location":"api/process/#sr2silo.process.AAInsertionSet.to_dict","title":"<code>to_dict()</code>","text":"<p>Return a dictionary with gene names as keys.</p>"},{"location":"api/process/#bam-conversion","title":"BAM Conversion","text":""},{"location":"api/process/#sr2silo.process.bam_to_sam","title":"<code>sr2silo.process.bam_to_sam(bam_file, sam_file)</code>","text":"<p>Converts a BAM file to SAM format and writes it to the specified output file.</p> <p>Parameters:</p> Name Type Description Default <code>bam_file</code> <code>Path</code> <p>Path to the input BAM file.</p> required <code>sam_file</code> <code>Path</code> <p>Path to the output SAM file.</p> required <code>sam_file</code> <code>Path</code> <p>Path to the output SAM file.</p> required"},{"location":"api/process/#sr2silo.process.sam_to_bam","title":"<code>sr2silo.process.sam_to_bam(sam_file, bam_file)</code>","text":"<p>Convert a SAM file to a BAM file.</p> <p>Parameters:</p> Name Type Description Default <code>sam_file</code> <code>Path</code> <p>Path to the input SAM file.</p> required <code>bam_file</code> <code>Path</code> <p>Path to the output BAM file.</p> required"},{"location":"api/process/#sr2silo.process.bam_to_fasta_query","title":"<code>sr2silo.process.bam_to_fasta_query(bam_file, fasta_file)</code>","text":"<p>Convert a BAM file to a FASTA file. Bluntly resolved the sam to fasta, removing soft clippings, keeping insertions and deletions, ignoring skipped regions and paddings.</p> <p>Outputs the sequence as it is read from the molecule.</p> <p>Parameters:</p> Name Type Description Default <code>bam_file</code> <code>Path</code> <p>Path to the input BAM file.</p> required <code>fasta_file</code> <code>Path</code> <p>Path to the output FASTQ file.</p> required"},{"location":"api/process/#sr2silo.process.sort_bam_file","title":"<code>sr2silo.process.sort_bam_file(input_bam_path, output_bam_path, sort_by_qname=False)</code>","text":"<p>Sorts a BAM file using pysam.sort by alignment positions by default, but can also sort by query name if specified.</p> <p>Parameters:</p> Name Type Description Default <code>input_bam_path</code> <code>Path</code> <p>Path to the input BAM file.</p> required <code>output_bam_path</code> <code>Path</code> <p>Path to the output sorted BAM file.</p> required <code>sort_by_qname</code> <code>bool</code> <p>If True, sorts by query name. Defaults to False.</p> <code>False</code>"},{"location":"api/process/#sr2silo.process.sort_and_index_bam","title":"<code>sr2silo.process.sort_and_index_bam(input_bam_fp, output_bam_fp)</code>","text":"<p>Function to sort and index the input BAM file,</p> <p>implements checks to see if the input BAM file is already sorted and indexed.</p> <p>If not sorted and indexed, the function will sort and index the input BAM file.</p>"},{"location":"api/process/#sr2silo.process.sort_sam_by_qname","title":"<code>sr2silo.process.sort_sam_by_qname(input_sam_path, output_sam_path)</code>","text":"<p>Sorts a sam file using pysam.sort command by query name. Args:     input_bam_path (Path): Path to the input BAM file.     output_bam_path (Path): Path to the output sorted BAM file.</p>"},{"location":"api/process/#sr2silo.process.get_gene_set_from_ref","title":"<code>sr2silo.process.get_gene_set_from_ref(reference_fp)</code>","text":"<p>Load the gene ref fasta and create a GeneSet with gene short names and lengths.</p>"},{"location":"api/process/#translation-and-alignment","title":"Translation and Alignment","text":""},{"location":"api/process/#sr2silo.process.nuc_to_aa_alignment","title":"<code>sr2silo.process.nuc_to_aa_alignment(in_nuc_alignment_fp, in_aa_db_fp, out_aa_alignment_fp)</code>","text":"<p>Function to convert files and translate and align with Diamond / blastx.</p> <p>Parameters:</p> Name Type Description Default <code>in_nuc_alignment_fp</code> <code>Path</code> <p>Path to the input nucleotide alignment file.</p> required <code>in_aa_db_fp</code> <code>Path</code> <p>Path to the input amino acid diamond database file.</p> required <code>out_aa_alignment_fp</code> <code>Path</code> <p>Path to the output amino acid alignment file.</p> required <p>Returns:</p> Type Description <code>None</code> <p>None</p> Description <p>Uses Diamond with the settings: --evalue 1 --gapopen 6 --gapextend 2 --outfmt 101 --matrix BLOSUM62 --unal 0 --max-hsps 1 --block-size 0.5</p>"},{"location":"api/process/#sr2silo.process.parse_translate_align","title":"<code>sr2silo.process.parse_translate_align(nuc_reference_fp, aa_reference_fp, nuc_alignment_fp, aa_db_fp, target_reference=None)</code>","text":"<p>Parse nucleotides, translate and align amino acids the input files.</p> <p>Parameters:</p> Name Type Description Default <code>nuc_reference_fp</code> <code>Path</code> <p>Path to nucleotide reference FASTA file.</p> required <code>aa_reference_fp</code> <code>Path</code> <p>Path to amino acid reference FASTA file.</p> required <code>nuc_alignment_fp</code> <code>Path</code> <p>Path to nucleotide alignment BAM file.</p> required <code>aa_db_fp</code> <code>Path</code> <p>Path to Diamond database file.</p> required <code>target_reference</code> <code>str | None</code> <p>Filter reads to only include those aligned to this              reference accession. If None, all reads are processed.</p> <code>None</code> <p>Returns:</p> Type Description <code>Dict[str, AlignedRead]</code> <p>Dictionary mapping read IDs to AlignedRead objects.</p>"},{"location":"api/process/#sr2silo.process.parse_translate_align_in_batches","title":"<code>sr2silo.process.parse_translate_align_in_batches(nuc_reference_fp, aa_reference_fp, nuc_alignment_fp, metadata_fp, output_fp, chunk_size=100000, write_chunk_size=20, target_reference=None)</code>","text":"<p>Parse nucleotides, translate and align amino acids in batches.</p> <p>Parameters:</p> Name Type Description Default <code>nuc_reference_fp</code> <code>Path</code> <p>Path to the nucleotide reference genome - .fasta</p> required <code>aa_reference_fp</code> <code>Path</code> <p>Path to the amino acid reference genome - .fasta</p> required <code>nuc_alignment_fp</code> <code>Path</code> <p>Path to the nucleotide alignment file - .bam</p> required <code>metadata_fp</code> <code>Path</code> <p>Path to the metadata file - .json</p> required <code>output_fp</code> <code>Path</code> <p>Path to the output file - .ndjson</p> required <code>chunk_size</code> <code>int</code> <p>Size of each batch, in number of reads.</p> <code>100000</code> <code>write_chunk_size</code> <code>int</code> <p>Size of each write batch.</p> <code>20</code> <code>target_reference</code> <code>str | None</code> <p>Filter reads to only include those aligned to this reference accession. Should match @SQ SN field in BAM header. If None, all reads are processed.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Path</code> <code>Path</code> <p>The path to the output file with the correct suffix.</p> Resources <p>A chunk_size of 100000 reads is a good starting point for most cases. This will take about 3.7 GB ram for Covid Genomes and 1-2 minutes to process.</p> Constraints <p>No sorting constraints are enforced on the input files. The output file is compressed with zstd.</p> Constraints <p>No sorting constraints are enforced on the input files. The output file is compressed with zstd.</p> Logs <p>All logs of INFO and below are suppressed.</p>"},{"location":"api/process/#sr2silo.process.curry_read_with_metadata","title":"<code>sr2silo.process.curry_read_with_metadata(metadata_fp)</code>","text":"<p>Returns a function that enriches an AlignedRead with metadata.</p> <p>Reads metadata from a JSON file and returns a function that enriches an AlignedRead with the loaded metadata.</p>"},{"location":"api/process/#read-merging","title":"Read Merging","text":""},{"location":"api/process/#sr2silo.process.paired_end_read_merger","title":"<code>sr2silo.process.paired_end_read_merger(nuc_align_sam_fp, ref_genome_fasta_fp, output_merged_sam_fp)</code>","text":"<p>Merge paired-end reads using <code>smallgenomutilities</code>tool <code>paired_end_read_merger</code>.</p> <p>Parameters:</p> Name Type Description Default <code>nuc_align_sam_fp</code> <code>Path</code> <p>Path to the nucleotide alignment SAM file.</p> required <code>ref_genome_fasta_fp</code> <code>Path</code> <p>Path to the reference genome FASTA file.</p> required <code>output_merged_sam_fp</code> <code>Path</code> <p>Path to the output merged SAM file.</p> required <p>Returns:</p> Type Description <code>None</code> <p>None</p>"},{"location":"api/process/#exceptions","title":"Exceptions","text":""},{"location":"api/process/#sr2silo.process.ZeroFilteredReadsError","title":"<code>sr2silo.process.ZeroFilteredReadsError</code>","text":"<p>               Bases: <code>Exception</code></p> <p>Raised when reference filtering results in zero reads.</p> <p>This error indicates that a target reference was specified for filtering, but no reads in the BAM file aligned to that reference. This typically means the wrong reference was specified or the data doesn't contain reads for the expected reference.</p>"},{"location":"api/schema/","title":"Data Schemas","text":"<p>Pydantic schemas defining the SILO database format for reads.</p> <p>These schemas validate read data before submission to SILO, ensuring all records conform to the expected format. Sequences follow IUPAC nucleotide codes.</p>"},{"location":"api/schema/#output-format","title":"Output Format","text":"<p>The output format for LAPIS-SILO v0.8.0+ uses:</p> <ul> <li>camelCase naming for metadata fields (e.g., <code>readId</code>, <code>sampleId</code>, <code>batchId</code>)</li> <li>Flat structure with metadata at root level (no nested \"metadata\" object)</li> <li>Segment format with <code>sequence</code>, <code>insertions</code>, and <code>offset</code> fields</li> <li>Insertion format as <code>\"position:sequence\"</code> (e.g., <code>\"123:ACGT\"</code>)</li> </ul>"},{"location":"api/schema/#modifying-the-schema","title":"Modifying the Schema","text":"<p>To customize the output schema for your use case:</p> <ol> <li>Edit the schema file at <code>src/sr2silo/silo_read_schema.py</code>:</li> <li>Add or modify fields in the <code>ReadMetadata</code> class</li> <li> <p>Use Pydantic <code>Field(alias=\"camelCaseName\")</code> for camelCase output</p> </li> <li> <p>Update the database config at <code>resources/silo/database_config.yaml</code>:</p> </li> <li> <p>Ensure field names match the Pydantic aliases</p> </li> <li> <p>Run validation to verify consistency:    <pre><code>python tests/test_database_config_validation.py\n</code></pre></p> </li> </ol> <p>This validation ensures your Pydantic schema matches the SILO database configuration.</p>"},{"location":"api/schema/#readmetadata","title":"ReadMetadata","text":""},{"location":"api/schema/#sr2silo.silo_read_schema.ReadMetadata","title":"<code>sr2silo.silo_read_schema.ReadMetadata</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>V-Pipe SILO-specific pydantic schema for ReadMetadata JSON format. (specific to WISE / run at ETHZ)</p> <p>Uses camelCase aliases for serialization to match SILO database schema, while maintaining snake_case field names for Python conventions.</p>"},{"location":"api/schema/#nucleotidesegment","title":"NucleotideSegment","text":""},{"location":"api/schema/#sr2silo.silo_read_schema.NucleotideSegment","title":"<code>sr2silo.silo_read_schema.NucleotideSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Schema for a nucleotide genomic segment (e.g., main nucleotide sequence).</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.NucleotideSegment.validate_nucleotide_insertions","title":"<code>validate_nucleotide_insertions(v)</code>  <code>classmethod</code>","text":"<p>Validate that nucleotide insertions have the format 'position:sequence'.</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.NucleotideSegment.validate_nucleotide_sequence","title":"<code>validate_nucleotide_sequence(v)</code>  <code>classmethod</code>","text":"<p>Validate that sequence contains only valid nucleotide characters.</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.NucleotideSegment.validate_offset","title":"<code>validate_offset(v)</code>  <code>classmethod</code>","text":"<p>Validate that offset is non-negative.</p>"},{"location":"api/schema/#aminoacidsegment","title":"AminoAcidSegment","text":""},{"location":"api/schema/#sr2silo.silo_read_schema.AminoAcidSegment","title":"<code>sr2silo.silo_read_schema.AminoAcidSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Schema for an amino acid genomic segment (e.g., gene sequences).</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.AminoAcidSegment.validate_amino_acid_insertions","title":"<code>validate_amino_acid_insertions(v)</code>  <code>classmethod</code>","text":"<p>Validate that amino acid insertions have the format 'position:sequence'.</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.AminoAcidSegment.validate_amino_acid_sequence","title":"<code>validate_amino_acid_sequence(v)</code>  <code>classmethod</code>","text":"<p>Validate that sequence contains only valid amino acid characters.</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.AminoAcidSegment.validate_offset","title":"<code>validate_offset(v)</code>  <code>classmethod</code>","text":"<p>Validate that offset is non-negative.</p>"},{"location":"api/schema/#alignedreadschema","title":"AlignedReadSchema","text":""},{"location":"api/schema/#sr2silo.silo_read_schema.AlignedReadSchema","title":"<code>sr2silo.silo_read_schema.AlignedReadSchema</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>SILO-specific pydantic schema for AlignedRead JSON format.</p> <p>This schema validates the new SILO format where: - readId is a required field at the root level (uses camelCase alias) - Metadata fields are at the root level (use camelCase aliases) - 'main' is a nucleotide segment with nucleotide-specific validation - Gene segments are amino acid segments with amino acid-specific validation - Unaligned sequences are prefixed with 'unaligned_'</p>"},{"location":"api/schema/#sr2silo.silo_read_schema.AlignedReadSchema.validate_dynamic_fields","title":"<code>validate_dynamic_fields()</code>","text":"<p>Validate gene segments, unaligned sequences, and metadata fields.</p>"},{"location":"api/vpipe/","title":"V-Pipe Integration","text":"<p>Utilities for working with V-Pipe output and file naming conventions.</p>"},{"location":"api/vpipe/#sample","title":"Sample","text":""},{"location":"api/vpipe/#sr2silo.vpipe.Sample","title":"<code>sr2silo.vpipe.Sample</code>","text":"<p>A sample object for V-Pipe.</p> <p>Parameters:</p> Name Type Description Default <code>sample_id</code> <code>str</code> <p>The sample ID.</p> required <code>organism</code> <code>str</code> <p>The organism identifier (e.g., 'covid', 'rsva').            Optional, defaults to 'covid' for backward compatibility.</p> <code>'covid'</code>"},{"location":"api/vpipe/#sr2silo.vpipe.Sample.enrich_metadata","title":"<code>enrich_metadata(timeline)</code>","text":"<p>Enrich the sample metadata with additional information.</p> <p>Parameters:</p> Name Type Description Default <code>timeline</code> <code>Path</code> <p>The path to the timeline file.</p> required"},{"location":"api/vpipe/#sr2silo.vpipe.Sample.get_metadata","title":"<code>get_metadata()</code>","text":"<p>Get the metadata for the sample.</p>"},{"location":"api/vpipe/#sr2silo.vpipe.Sample.set_metadata","title":"<code>set_metadata()</code>","text":"<p>Get the metadata for the sample.</p>"},{"location":"contributing/branching-strategy/","title":"Branching Strategy","text":"<p>This project follows a simple but effective branching strategy centered around two main branches:</p>"},{"location":"contributing/branching-strategy/#main-branches","title":"Main Branches","text":"<ol> <li>main: The production-ready branch that always contains stable, releasable code.</li> <li>Always deployable</li> <li>Protected from direct pushes</li> <li> <p>Changes come from merged PRs from the <code>dev</code> branch</p> </li> <li> <p>dev: The development branch where features and fixes are integrated.</p> </li> <li>Used for day-to-day development work</li> <li>Integration branch for features and fixes</li> <li>Code here should pass all tests but may not be production-ready</li> <li>Pull requests target this branch</li> </ol>"},{"location":"contributing/branching-strategy/#feature-development","title":"Feature Development","text":"<p>When working on new features or bug fixes, follow these steps:</p> <ol> <li> <p>Create a feature branch from <code>dev</code>:    <pre><code>git checkout dev\ngit pull origin dev\ngit checkout -b feature/your-feature-name\n</code></pre></p> </li> <li> <p>Make your changes, commit them, and push to your feature branch:    <pre><code>git add .\ngit commit -m \"Descriptive commit message\"\ngit push origin feature/your-feature-name\n</code></pre></p> </li> <li> <p>Create a pull request from your feature branch to the <code>dev</code> branch.</p> </li> <li> <p>After review and approval, your changes will be merged into the <code>dev</code> branch.</p> </li> </ol>"},{"location":"contributing/branching-strategy/#releases","title":"Releases","text":"<p>When the <code>dev</code> branch contains enough features for a release or a scheduled release is due:</p> <ol> <li>Create a pull request from <code>dev</code> to <code>main</code>.</li> <li>Review the changes thoroughly.</li> <li>After approval, merge the pull request to deploy to production.</li> <li>Tag the release in the <code>main</code> branch with a version number.</li> </ol>"},{"location":"contributing/branching-strategy/#hotfixes","title":"Hotfixes","text":"<p>For critical production issues:</p> <ol> <li> <p>Create a hotfix branch from <code>main</code>:    <pre><code>git checkout main\ngit pull origin main\ngit checkout -b hotfix/issue-description\n</code></pre></p> </li> <li> <p>Fix the issue, commit, and push:    <pre><code>git add .\ngit commit -m \"Fix critical issue\"\ngit push origin hotfix/issue-description\n</code></pre></p> </li> <li> <p>Create PRs to both <code>main</code> and <code>dev</code> branches to ensure the fix is applied to both branches.</p> </li> </ol>"},{"location":"usage/configuration/","title":"Configuration Guide","text":"<p>sr2silo supports flexible configuration through command-line arguments and environment variables, making it easy to use in different deployment scenarios.</p>"},{"location":"usage/configuration/#command-line-arguments","title":"Command-Line Arguments","text":"<p>View all available arguments:</p> <pre><code>sr2silo process-from-vpipe --help\nsr2silo submit-to-loculus --help\n</code></pre>"},{"location":"usage/configuration/#environment-variables","title":"Environment Variables","text":"<p>Environment variables provide configuration defaults. CLI arguments override environment variables.</p>"},{"location":"usage/configuration/#processing-configuration-process-from-vpipe","title":"Processing Configuration (process-from-vpipe)","text":"Variable Purpose Default Example <code>ORGANISM</code> Organism identifier None (required) <code>covid</code>, <code>rsva</code> <code>TIMELINE_FILE</code> Metadata timeline file None (required) <code>/path/to/timeline.tsv</code> <code>LAPIS_URL</code> LAPIS instance URL (optional) None <code>https://lapis.example.com</code> <code>NUC_REF</code> Nucleotide reference FASTA None <code>/path/to/nuc_ref.fasta</code> <code>AA_REF</code> Amino acid reference FASTA None <code>/path/to/aa_ref.fasta</code> <code>REFERENCE_ACCESSION</code> Filter reads by reference accession <code>\"\"</code> (all reads) <code>EPI_ISL_412866</code> <code>XDG_CACHE_HOME</code> Override cache location <code>~/.cache</code> <code>/scratch/.cache</code>"},{"location":"usage/configuration/#reference-files","title":"Reference Files","text":"<p>sr2silo needs nucleotide and amino acid reference files for processing. You can provide these in several ways:</p> <p>Option 1: Explicit Paths (Recommended for Production)</p> <pre><code>sr2silo process-from-vpipe \\\n  --input-file alignments.bam \\\n  --nuc-ref /path/to/nuc_ref.fasta \\\n  --aa-ref /path/to/aa_ref.fasta \\\n  ...\n</code></pre> <p>Option 2: LAPIS Auto-Fetch</p> <p>Fetch references automatically from a LAPIS instance:</p> <pre><code>sr2silo process-from-vpipe \\\n  --lapis-url https://lapis.wasap.genspectrum.org/covid \\\n  ...\n</code></pre> <p>References are cached to <code>~/.cache/sr2silo/references/</code> (or <code>$XDG_CACHE_HOME/sr2silo/</code>).</p> <p>Option 3: Environment Variables</p> <pre><code>export NUC_REF=/path/to/nuc_ref.fasta\nexport AA_REF=/path/to/aa_ref.fasta\nsr2silo process-from-vpipe ...\n</code></pre> <p>Priority Order:</p> <ol> <li>CLI flags (<code>--nuc-ref</code>, <code>--aa-ref</code>)</li> <li>Environment variables (<code>NUC_REF</code>, <code>AA_REF</code>)</li> <li>LAPIS auto-fetch with cache (if <code>--lapis-url</code> provided)</li> </ol>"},{"location":"usage/configuration/#reference-filtering","title":"Reference Filtering","text":"<p>When processing BAM files containing alignments to multiple similar references (e.g., RSV-A and RSV-B), use <code>--reference-accession</code> to filter reads:</p> <pre><code>sr2silo process-from-vpipe \\\n  --input-file alignments.bam \\\n  --reference-accession \"EPI_ISL_412866\" \\\n  ...\n</code></pre> <p>To find available reference accessions in your BAM file:</p> <pre><code>samtools view -H file.bam | grep @SQ\n</code></pre> <p>If filtering results in zero reads, processing terminates with a <code>ZeroFilteredReadsError</code>.</p>"},{"location":"usage/configuration/#submission-configuration-submit-to-loculus","title":"Submission Configuration (submit-to-loculus)","text":"Variable Purpose Default Example <code>ORGANISM</code> Organism identifier None (required) <code>covid</code>, <code>rsva</code> <code>KEYCLOAK_TOKEN_URL</code> Authentication endpoint None (required) <code>https://auth.example.com/token</code> <code>BACKEND_URL</code> SILO backend API endpoint None (required) <code>https://api.example.com/api</code> <code>GROUP_ID</code> Loculus group ID None (required) <code>1</code>, <code>42</code> <code>USERNAME</code> Submission username None (required) Your username <code>PASSWORD</code> Submission password None (required) Your password <code>AUTO_RELEASE</code> Auto-approve sequences after submission <code>false</code> <code>true</code>"},{"location":"usage/configuration/#auto-release","title":"Auto-Release","text":"<p>Automatically approve/release sequences after submission:</p> <pre><code># Via CLI flag\nsr2silo submit-to-loculus \\\n  -f data.ndjson.zst \\\n  -a alignment.bam \\\n  --auto-release\n\n# With custom delay (default: 180 seconds)\nsr2silo submit-to-loculus \\\n  -f data.ndjson.zst \\\n  -a alignment.bam \\\n  --auto-release \\\n  --release-delay 60\n\n# Via environment variable\nexport AUTO_RELEASE=true\nsr2silo submit-to-loculus -f data.ndjson.zst -a alignment.bam\n</code></pre> <p>The <code>--release-delay</code> option (default 180s) allows backend processing time before release.</p>"},{"location":"usage/configuration/#snakemake-workflow","title":"Snakemake Workflow","text":"<p>Configure in <code>workflow/config.yaml</code>: <pre><code>ORGANISM: \"covid\"\nREFERENCE_ACCESSION: \"\"  # Filter reads by reference (use for RSV-A/B)\nAUTO_RELEASE: false      # Auto-approve after submission\nLAPIS_URL: \"https://lapis.wasap.genspectrum.org/\"\nKEYCLOAK_TOKEN_URL: \"https://auth.db.wasap.genspectrum.org/...\"\nBACKEND_URL: \"https://api.db.wasap.genspectrum.org/...\"\nGROUP_ID: 1\n</code></pre></p>"},{"location":"usage/configuration/#best-practices","title":"Best Practices","text":"<ul> <li>Store credentials in environment variables, not in code</li> <li>Use CLI arguments for experiment-specific settings that override defaults</li> <li>Create setup scripts for your deployment environment</li> <li>Use <code>--help</code> to verify available options</li> </ul>"},{"location":"usage/configuration/#troubleshooting","title":"Troubleshooting","text":"<p>ORGANISM not set: Export variable or use <code>--organism</code> flag</p> <p>Reference files not found: Provide <code>--nuc-ref</code> and <code>--aa-ref</code> paths, or use <code>--lapis-url</code> to fetch automatically</p> <p>Cached references outdated: Delete <code>~/.cache/sr2silo/references/</code> and re-run with <code>--lapis-url</code></p> <p>Authentication failed: Verify credentials and endpoint URLs in environment variables</p>"},{"location":"usage/deployment/","title":"Multi-Virus Deployment Guide","text":"<p>This guide explains how to deploy the sr2silo workflow for multiple viruses (e.g., SARS-CoV-2, RSV-A) on the ETH Euler cluster using the shared deployment infrastructure.</p>"},{"location":"usage/deployment/#overview","title":"Overview","text":"<p>The deployment system allows you to run independent daily workflows for different viruses using a shared codebase and credential store. Each virus has its own configuration file, but they share the same SLURM submission script and secrets.</p>"},{"location":"usage/deployment/#directory-structure","title":"Directory Structure","text":"<p>The deployment configuration is located in the <code>deployments/</code> directory:</p> <pre><code>deployments/\n\u251c\u2500\u2500 secrets.py            # Credential loader (Python)\n\u251c\u2500\u2500 secrets/              # Shared Loculus credentials (GPG encrypted)\n\u251c\u2500\u2500 submit-daily.sbatch   # Shared SLURM script\n\u251c\u2500\u2500 _templates/           # Template for new viruses\n\u251c\u2500\u2500 covid/                # SARS-CoV-2 configuration\n\u2514\u2500\u2500 rsva/                 # RSV-A configuration\n</code></pre>"},{"location":"usage/deployment/#1-credential-setup","title":"1. Credential Setup","text":"<p>We use GPG symmetric encryption to store the shared Loculus credentials (<code>USERNAME</code> and <code>PASSWORD</code>) securely.</p> <p>To create or update the encrypted credentials file:</p> <pre><code># You will be prompted for the passphrase twice\necho -e \"USERNAME=vpipe\\nPASSWORD=your_actual_password\" | gpg --symmetric --cipher-algo AES256 -o deployments/secrets/credentials.enc\n</code></pre>"},{"location":"usage/deployment/#2-running-deployments","title":"2. Running Deployments","text":"<p>The <code>deployments/submit-daily.sbatch</code> script handles the execution and automatic resubmission of the workflow.</p>"},{"location":"usage/deployment/#starting-a-daily-cycle","title":"Starting a Daily Cycle","text":"<p>To start the workflow for a specific virus, submit the job with the <code>VIRUS</code> and <code>GPG_PASSPHRASE</code> variables.</p> <p>Example: Start RSV-A immediately <pre><code>sbatch --job-name=sr2silo-rsva \\\n       --export=VIRUS=rsva,GPG_PASSPHRASE=\"your_passphrase\" \\\n       --begin=now \\\n       deployments/submit-daily.sbatch\n</code></pre></p> <p>Example: Schedule SARS-CoV-2 for 23:00 <pre><code>sbatch --job-name=sr2silo-covid \\\n       --export=VIRUS=covid,GPG_PASSPHRASE=\"your_passphrase\" \\\n       --begin=23:00 \\\n       deployments/submit-daily.sbatch\n</code></pre></p>"},{"location":"usage/deployment/#automatic-resubmission","title":"Automatic Resubmission","text":"<p>The job is configured to automatically resubmit itself for the next day at 23:00 upon successful completion. It preserves the <code>VIRUS</code> and <code>GPG_PASSPHRASE</code> variables for the next run.</p>"},{"location":"usage/deployment/#monitoring","title":"Monitoring","text":"<p>Jobs will appear in the SLURM queue with descriptive names:</p> <pre><code>squeue -u $USER -o \"%.18i %.9P %.20j %.8u %.2t %.10M %.6D %R\"\n</code></pre> <p>Output: <pre><code>JOBID              NAME                 USER    ST      START_TIME\n51521886           sr2silo-rsva         koehng  PD      2025-12-12T23:00:00\n51522132           sr2silo-covid        koehng  PD      2025-12-12T23:00:00\n</code></pre></p>"},{"location":"usage/deployment/#3-adding-a-new-virus","title":"3. Adding a New Virus","text":"<p>To deploy the workflow for a new virus:</p> <ol> <li> <p>Create Configuration Directory:     Copy the template directory:     <pre><code>cp -r deployments/_templates deployments/my-new-virus\n</code></pre></p> </li> <li> <p>Edit Configuration:     Modify <code>deployments/my-new-virus/config.yaml</code>:</p> <ul> <li><code>VIRUS_NAME</code>: Internal name (used for folder names).</li> <li><code>VIRUS_DISPLAY_NAME</code>: Human-readable name.</li> <li><code>ORGANISM</code>: Must match a supported organism in <code>sr2silo</code> (see <code>src/sr2silo/configs/organisms.py</code>).</li> <li><code>LOCATIONS</code>: List of location IDs to process.</li> <li><code>BASE_SAMPLE_DIR</code>: Path to V-Pipe output directory.</li> <li><code>TIMELINE_FILE</code>: Path to the timeline metadata file.</li> </ul> </li> <li> <p>Deploy:     Submit the job as described in section 2.</p> </li> </ol>"},{"location":"usage/organisms/","title":"Multi-Organism Support","text":"<p>sr2silo supports processing samples from multiple organisms with organism-specific reference sequences.</p>"},{"location":"usage/organisms/#supported-organisms","title":"Supported Organisms","text":"Organism Identifier Description COVID-19 <code>covid</code> SARS-CoV-2 / Severe acute respiratory syndrome coronavirus 2 RSV-A <code>rsva</code> Respiratory Syncytial Virus A"},{"location":"usage/organisms/#reference-resolution","title":"Reference Resolution","text":"<p>sr2silo resolves reference sequences in the following priority order:</p> <ol> <li>Local References (fastest): <code>resources/references/{organism}/</code></li> <li>LAPIS Instance: Fetched from specified <code>--lapis-url</code> if available</li> <li>Fallback: Local references as final fallback if LAPIS fetch fails</li> </ol> <p>This allows for both static local references and dynamic references from a LAPIS instance.</p>"},{"location":"usage/organisms/#usage","title":"Usage","text":"<p>For detailed usage, see: <pre><code>sr2silo process-from-vpipe --help\n</code></pre></p> <p>The <code>--organism</code> parameter specifies which organism to process. Can also be set via <code>ORGANISM</code> environment variable (CLI argument takes precedence).</p>"},{"location":"usage/organisms/#adding-new-organisms","title":"Adding New Organisms","text":"<p>To add support for a new organism:</p> <ol> <li>Add reference files to <code>resources/references/{organism_id}/</code>:</li> <li><code>nuc_ref.fasta</code> - Nucleotide reference sequence(s)</li> <li> <p><code>aa_ref.fasta</code> - Amino acid reference sequences for gene annotations</p> </li> <li> <p>Use GenBank parser (if starting from GenBank format):    <pre><code>python scripts/extract_gbk_references.py \\\n    reference.gbk \\\n    --nuc-output resources/references/{organism_id}/nuc_ref.fasta \\\n    --aa-output resources/references/{organism_id}/aa_ref.fasta\n</code></pre></p> </li> <li> <p>Update configuration (optional):</p> </li> <li>Update workflow <code>config.yaml</code> with your new organism ID</li> <li> <p>Update documentation with organism details</p> </li> <li> <p>Test (optional):</p> </li> <li>Add test fixtures in <code>tests/conftest.py</code></li> <li>Add parameterized tests in <code>tests/test_main.py</code></li> </ol>"},{"location":"usage/organisms/#workflow-integration","title":"Workflow Integration","text":"<p>Specify organism in <code>workflow/config.yaml</code>: <pre><code>ORGANISM: \"covid\"  # or \"rsva\"\n</code></pre></p>"},{"location":"usage/organisms/#troubleshooting","title":"Troubleshooting","text":"<p>Reference files not found: - Verify files exist: <code>ls resources/references/{organism}/</code> - Check organism identifier spelling - Use <code>--lapis-url</code> to fetch from LAPIS - Generate from GenBank: <code>python scripts/extract_gbk_references.py --help</code></p>"},{"location":"usage/resource_requirements/","title":"Resource Requirements","text":"<p>When running sr2silo, especially the <code>--import to loculus</code> command, you should be aware of the following resource requirements:</p>"},{"location":"usage/resource_requirements/#memory-requirements","title":"Memory Requirements","text":"<ul> <li>Standard Resources: The default Snakemake configuration uses 8 GB RAM and one CPU core</li> <li>Actual Usage: </li> <li>sr2silo processes in batches of 100k reads at a time, requiring approximately 3 GB of RAM</li> <li>An additional 3 GB of RAM is needed for running Diamond for amino acid translation and alignment</li> </ul>"},{"location":"usage/resource_requirements/#storage-requirements","title":"Storage Requirements","text":"<ul> <li>Temporary Space: </li> <li>sr2silo itself requires some temporary directory space</li> <li>Diamond may require up to 30 GB of temporary storage</li> <li>Ideally, this should be on high I/O storage</li> </ul>"},{"location":"usage/resource_requirements/#cluster-environment-configuration","title":"Cluster Environment Configuration","text":"<p>When running on a personal computer, standard temporary directories are usually sufficient as long as you have free disk space. However, in a cluster environment:</p> <ol> <li>Set the environment variable <code>TMPDIR</code> to a location with at least 50 GB of free space per run:</li> </ol> <pre><code>export TMPDIR=/path/to/temp/directory\n</code></pre> <ol> <li>Make sure this directory has good I/O performance for optimal processing speed</li> </ol> <p>This configuration will help prevent issues with temporary file storage during the processing of large datasets.</p>"}]}